# TelegramApiLib - Библиотека Google Apps Script для Telegram Bot API

Эта библиотека предоставляет удобный и структурированный интерфейс для взаимодействия с Telegram Bot API из среды Google Apps Script. Она позволяет легко отправлять сообщения, управлять чатами, обрабатывать входящие обновления и многое другое.

## Содержание

- [Установка и подключение](#установка-и-подключение)
- [Управление токеном бота](#управление-токеном-бота)
- [Настройка вебхука](#настройка-вебхука)
- [Использование в качестве библиотеки](#использование-в-качестве-библиотеки)
- [Документация функций API](#документация-функций-api)
- [Примеры использования](#примеры-использования)

## Установка и подключение

### Через `clasp` (рекомендуемый способ для разработчиков)

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/Gakuzi/TelegramApiLib.git
    cd TelegramApiLib
    ```
2.  **Установите `clasp`:** Если у вас еще нет `clasp`, установите его глобально:
    ```bash
    npm install -g @google/clasp
    ```
3.  **Войдите в аккаунт Google:**
    ```bash
    clasp login
    ```
4.  **Создайте новый проект Apps Script или свяжитесь с существующим:**
    *   **Создать новый:**
        ```bash
        clasp create --type library --title TelegramApiLib
        ```
    *   **Связаться с существующим:**
        ```bash
        clasp clone <Script ID> --rootDir .
        ```
        (Где `<Script ID>` - это идентификатор вашего проекта Apps Script, который можно найти в URL проекта: `script.google.com/d/<Script ID>/edit`)
5.  **Загрузите код:**
    ```bash
    clasp push
    ```

### Вручную (для пользователей библиотеки)

1.  **Создайте новый проект Apps Script:** Перейдите в [Google Apps Script](https://script.google.com/home) и создайте новый проект.
2.  **Скопируйте файлы:** Откройте каждый `.gs` файл из этого репозитория (например, `BotManagement.gs`, `SendingMessages.gs` и т.д.) и скопируйте его содержимое в соответствующие файлы в вашем проекте Apps Script. Убедитесь, что имена файлов совпадают.
3.  **Скопируйте `appsscript.json`:** Скопируйте содержимое файла `appsscript.json` в файл манифеста вашего проекта Apps Script (Вид -> Показать файл манифеста).

## Управление токеном бота

Токен вашего Telegram бота должен храниться безопасно, и `PropertiesService` в Google Apps Script идеально подходит для этой цели. Библиотека использует свойство `TELEGRAM_BOT_TOKEN`.

### Установка токена

Вы можете установить токен программно, вызвав функцию `setMyBotToken` из `Settings.gs` один раз:

```javascript
function setMyBotToken() {
  // Замените 'YOUR_BOT_TOKEN' на фактический токен вашего бота
  setBotToken('YOUR_BOT_TOKEN');
}
```

Или вручную:

1.  Откройте ваш проект Apps Script.
2.  Перейдите в `Настройки проекта` (значок шестеренки).
3.  Прокрутите вниз до раздела `Свойства скрипта`.
4.  Добавьте новое свойство:
    *   **Ключ:** `TELEGRAM_BOT_TOKEN`
    *   **Значение:** `ВАШ_ТОКЕН_БОТА`
5.  Нажмите `Сохранить свойства`.

### Получение токена

Токен автоматически извлекается функцией `getBotToken()` внутри библиотеки. Вам не нужно вызывать ее напрямую.

## Настройка вебхука

Для получения обновлений от Telegram ваш бот должен иметь настроенный вебхук. Это URL вашего развернутого скрипта Apps Script.

1.  **Разверните скрипт как веб-приложение:**
    *   В вашем проекте Apps Script перейдите в `Развертывания` (значок `</>`).
    *   Нажмите `Новое развертывание`.
    *   Выберите тип `Веб-приложение`.
    *   Настройте:
        *   **Выполнять как:** `Я` (ваш аккаунт Google)
        *   **Кто имеет доступ:** `Любой` (или `Любой, даже анонимный`, если бот публичный)
    *   Нажмите `Развернуть`.
    *   Скопируйте `URL веб-приложения`.
2.  **Установите вебхук с помощью библиотеки:**
    Используйте функцию `setWebhook` из `BotManagement.gs`:
    ```javascript
    function setupWebhook() {
      const webAppUrl = 'ВАШ_URL_ВЕБ_ПРИЛОЖЕНИЯ'; // Вставьте скопированный URL
      setWebhook(webAppUrl);
      Logger.log('Вебхук успешно установлен.');
    }
    ```
    Выполните эту функцию один раз в вашем проекте Apps Script.

### Проверка и удаление вебхука

-   **Получить информацию о вебхуке:**
    ```javascript
    function checkWebhookInfo() {
      const info = getWebhookInfo();
      Logger.log(JSON.stringify(info, null, 2));
    }
    ```
-   **Удалить вебхук:**
    ```javascript
    function removeWebhook() {
      deleteWebhook();
      Logger.log('Вебхук успешно удален.');
    }
    ```

## Использование в качестве библиотеки

Чтобы использовать `TelegramApiLib` в другом проекте Google Apps Script:

1.  **Получите ID проекта библиотеки:**
    *   Откройте проект `TelegramApiLib` в Google Apps Script.
    *   Перейдите в `Настройки проекта` (значок шестеренки).
    *   Скопируйте `Идентификатор скрипта`.
2.  **Добавьте библиотеку в ваш проект:**
    *   Откройте проект Apps Script, в котором вы хотите использовать `TelegramApiLib`.
    *   В левой панели навигации найдите `Библиотеки` и нажмите `+`.
    *   Вставьте `Идентификатор скрипта` библиотеки `TelegramApiLib`.
    *   Нажмите `Найти`.
    *   Выберите последнюю версию (рекомендуется использовать фиксированную версию, а не `Head`).
    *   Оставьте идентификатор по умолчанию (`TelegramApiLib`) или задайте свой.
    *   Нажмите `Добавить`.

Теперь вы можете вызывать функции из `TelegramApiLib` в вашем проекте, например: `TelegramApiLib.sendMessage(...)`.

## Примеры использования

(Будут добавлены позже)
